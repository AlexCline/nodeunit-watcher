#!/usr/bin/env node

var fs   = require('fs'),
    exec = require('child_process').exec;
    
var args = (process.ARGV || process.argv).slice(2);
var files = [];

args.forEach(function(arg) {
    if (arg.slice(0, 1) !== '-' && fs.existsSync(arg)) {
      files.push(arg);
    }
});

console.log('Watching files: ' + files.join(',') + '  Crtl-C to Exit.');
files.forEach(function(file){

  exec('nodeunit ' + args.join(" "), function (error, stdout, stderr) {
    console.log(stdout);
    if(stderr) {
      console.log(stderr);
    }
  });

  fs.watchFile(file, { persistent: true, interval: 2000 }, function(c, p){
    if(c.mtime > p.mtime) {
    
      exec('nodeunit ' + args.join(" "), function (error, stdout, stderr) {
        console.log(stdout);
        if(stderr) {
          console.log(stderr);
        }
      });

    }
  });
});